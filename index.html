<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harmonogram Salonu Kosmetycznego</title>
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="Profesjonalne zarzƒÖdzanie harmonogramem salonu kosmetycznego">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <style>
        /* CSS styles remain the same as the previous version */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            color: #333;
            line-height: 1.6;
            padding: 10px;
        }
        
        .view {
            display: none;
        }
        
        .active-view {
            display: block;
        }
        
        .login-container, .employee-select {
            max-width: 500px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        h1 {
            text-align: center;
            font-size: 1.8rem;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
            margin-top: 10px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            min-height: 44px;
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        button.delete {
            background: #e74c3c;
        }
        
        button.delete:hover {
            background: #c0392b;
        }
        
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 8px;
            background: #f1f5f9;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            text-align: center;
            min-width: 120px;
        }
        
        .nav-tab.active {
            background: #3498db;
            color: white;
        }
        
        select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            min-height: 44px;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: #5d6d7e;
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .day {
            border: 1px solid #e0e0e0;
            padding: 10px;
            min-height: 100px;
            background: white;
            cursor: pointer;
            position: relative;
            transition: all 0.3s;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }
        
        .day:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            background: #f0f7ff;
            border-color: #3498db;
        }
        
        .today {
            background-color: #e1f5fe;
            border: 2px solid #3498db;
        }
        
        .day-number {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #2c3e50;
            align-self: flex-start;
            background: #f8f9fa;
            padding: 3px 8px;
            border-radius: 20px;
        }
        
        .appointment {
            font-size: 0.8rem;
            margin: 4px 0;
            padding: 6px;
            background: #e8f5e9;
            border-radius: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-left: 4px solid #2ecc71;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .day-details {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            display: none;
            border: 1px solid #e0e0e0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .appointment-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border-radius: 10px;
            align-items: center;
            border-left: 4px solid #3498db;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .appointment-details {
            flex: 1;
        }
        
        .appointment-actions {
            display: flex;
            gap: 8px;
        }
        
        input, select {
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 100%;
            font-size: 1rem;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            min-height: 44px;
        }
        
        .add-appointment {
            margin: 20px 0;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        .time-inputs select {
            flex: 1;
        }
        
        .duration-slider-container {
            margin: 15px 0;
        }
        
        .duration-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 5px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }
        
        .duration-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .duration-slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .duration-value {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.9rem;
            color: #555;
        }
        
        .duration-display {
            font-weight: bold;
            color: #3498db;
        }

        .summary, .month-summary {
            margin-top: 20px;
            padding: 20px;
            background: #e9f7ef;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .month-summary {
            background: #e3f2fd;
        }
        
        .summary h3, .month-summary h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .summary p, .month-summary p {
            font-size: 1.1rem;
            margin: 8px 0;
        }

        /* Nowy styl dla timeline */
        .timeline-container {
            position: relative;
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 12px;
            overflow: hidden;
            background: #f9f9f9;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            padding: 10px;
        }

        .timeline-hour {
            display: flex;
            margin-bottom: 10px;
        }

        .hour-label {
            width: 60px;
            font-weight: bold;
            color: #555;
            padding: 5px;
            text-align: center;
            background: #eee;
            border-radius: 6px;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .hour-slots {
            flex-grow: 1;
            position: relative;
            min-height: 50px;
        }

        .booked-slot {
            position: relative;
            background: white;
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            z-index: 1;
        }

        .booked-slot.pedicure-block {
            border-color: #e74c3c;
            background: #ffebee;
        }

        .booked-slot.other-employee {
            border-color: #9b59b6;
            background: #f5eef8;
        }

        .slot-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .slot-time {
            color: #3498db;
            font-size: 0.9em;
        }

        .slot-client {
            font-size: 1.1em;
            color: #2c3e50;
        }

        .slot-service {
            color: #555;
            font-size: 0.9em;
        }

        .slot-actions {
            margin-top: 5px;
            display: flex;
            gap: 5px;
        }

        .slot-actions button {
            padding: 3px 8px;
            font-size: 0.8em;
            min-height: auto;
        }

        .empty {
            background: #f9f9f9;
            border: 1px dashed #ddd;
            cursor: default;
        }
        
        .empty:hover {
            transform: none;
            box-shadow: none;
            background: #f9f9f9;
        }
        
        #login-error {
            color: #e74c3c;
            margin-top: 15px;
            font-weight: 600;
        }
        
        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: #f1f5f9;
            padding: 12px;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .service-category {
            margin: 15px 0;
            padding: 15px;
            background: #f0f7ff;
            border-radius: 12px;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .service-category h4 {
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .service-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 12px;
        }
        
        .service-option {
            padding: 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .service-option:hover {
            background: #e3f2fd;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #3498db;
        }
        
        .service-option.selected {
            background: #bbdefb;
            border-color: #64b5f6;
            font-weight: bold;
        }
        
        .selected-service {
            margin-top: 15px;
            padding: 12px;
            background: #e8f5e9;
            border-radius: 8px;
            font-weight: bold;
            border-left: 5px solid #2ecc71;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .service-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 12px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .other-service-input {
            margin-top: 10px;
            display: none;
        }
        
        .other-employee-note {
            color: #9b59b6;
            font-size: 0.85rem;
            margin-top: 5px;
            font-weight: bold;
        }
        
        .clients-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .clients-table th, .clients-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .clients-table th {
            background-color: #5d6d7e;
            color: white;
        }
        
        .clients-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .clients-table tr:hover {
            background-color: #e3f2fd;
        }
        
        .client-form {
            margin-top: 20px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .autocomplete-items {
            position: absolute;
            border: 1px solid #d4d4d4;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            max-height: 200px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-radius: 0 0 8px 8px;
        }
        
        .autocomplete-item {
            padding: 10px;
            cursor: pointer;
            background-color: #fff; 
            border-bottom: 1px solid #d4d4d4; 
        }
        
        .autocomplete-item:hover {
            background-color: #e9e9e9; 
        }
        
        .autocomplete-active {
            background-color: #3498db !important;
            color: #ffffff;
        }
        
        .autocomplete-container {
            position: relative;
        }
        
        .employee-list {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .employee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 10px 0;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        .pedicure-warning {
            color: #e74c3c;
            font-weight: bold;
            background: #ffebee;
            padding: 10px;
            border-radius: 8px;
            margin-top: 8px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }
        
        /* Harmonogram dnia */
        .day-schedule {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .schedule-column {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 15px;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            min-width: 300px;
        }
        
        .schedule-column h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #2c3e50;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .appointments-table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .appointments-table th, .appointments-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        .appointments-table th {
            background-color: #5d6d7e;
            color: white;
        }
        
        .appointments-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .appointments-table tr:hover {
            background-color: #e3f2fd;
        }
        
        .price-input {
            width: 80px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .pedicure-row {
            background-color: #ffe6e6 !important;
        }
        
        .schedule-column .empty-schedule {
            text-align: center;
            padding: 20px;
            color: #777;
            font-style: italic;
            font-size: 1rem;
        }
        
        .pedicure-blocked {
            background-color: #ffcccc !important;
            color: #cc0000;
            font-weight: bold;
        }
        
        /* Nowe elementy wizualne */
        .logo-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .logo-header h1 {
            font-size: 2rem;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .logo-header p {
            color: #5d6d7e;
            font-size: 1rem;
        }
        
        .stats-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            min-width: 200px;
        }
        
        .stat-box h3 {
            color: #3498db;
            font-size: 1.2rem;
            margin-bottom: 12px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #5d6d7e;
            margin-top: 8px;
            font-size: 1rem;
        }
        
        .day-navigation {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .reset-stats {
            background: #e74c3c;
            margin-top: 12px;
            padding: 15px 25px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .reset-section {
            margin-top: 40px;
            padding: 25px;
            background: #fff8f8;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #ffd6d6;
            text-align: center;
        }
        
        .reset-warning {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .reset-description {
            margin-bottom: 20px;
            color: #666;
        }
        
        /* Nowe style dla podsumowa≈Ñ */
        .yearly-summary-section, .year-summary-section {
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .yearly-stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .year-summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .year-summary-table th {
            background: #5d6d7e;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .year-summary-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .year-summary-table tr:hover {
            background-color: #f5f7fa;
        }
        
        .year-summary-table .year-row {
            font-weight: bold;
            background-color: #e3f2fd;
        }
        
        .year-summary-table .year-total {
            font-weight: bold;
            background-color: #e8f5e9;
        }
        
        /* Responsywno≈õƒá */
        @media (max-width: 992px) {
            .form-row, .stats-container {
                flex-direction: column;
            }
            
            .service-options {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .day-schedule {
                flex-direction: column;
            }
            
            .day-navigation {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .calendar {
                grid-template-columns: repeat(1, 1fr);
            }
            
            .day-header {
                display: none;
            }
            
            .time-inputs {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .container, .login-container, .employee-select {
                padding: 15px;
                margin: 10px auto;
            }
            
            .calendar-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .calendar-nav {
                justify-content: center;
            }
            
            .employee-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .stats-container {
                flex-direction: column;
            }
            
            .day-schedule {
                flex-direction: column;
            }
            
            .appointments-table th, 
            .appointments-table td,
            .clients-table th,
            .clients-table td {
                padding: 10px;
                font-size: 0.9rem;
            }

            /* Responsywno≈õƒá dla nowego timeline */
            .timeline-hour {
                flex-direction: column;
            }
            
            .hour-label {
                width: 100%;
                margin-bottom: 5px;
                margin-right: 0;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            h2 {
                font-size: 1.2rem;
            }
            
            h3 {
                font-size: 1.1rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            button {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .calendar {
                grid-template-columns: repeat(1, 1fr);
                gap: 8px;
            }
            
            .day {
                min-height: 80px;
                padding: 8px;
            }
            
            .day-number {
                font-size: 1rem;
            }
            
            .appointment {
                font-size: 0.75rem;
                padding: 4px;
            }
            
            .service-options {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            /* Dodatkowe style dla dni w kalendarzu na mobilkach */
            .day-header-mobile {
                display: block;
                font-weight: bold;
                margin-bottom: 5px;
                color: #2c3e50;
            }
        }

        /* Dodatkowe poprawki dla bardzo ma≈Çych ekran√≥w */
        @media (max-width: 360px) {
            .calendar-header h2 {
                font-size: 1.1rem;
            }
            
            .logo-header h1 {
                font-size: 1.6rem;
            }
            
            .logo-header p {
                font-size: 0.9rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .stat-box {
                min-width: 100%;
            }
        }
        
        /* Przewijane tabele na ma≈Çych ekranach */
        .table-wrapper {
            overflow-x: auto;
            margin-top: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0,0,0,0.05);
        }

        /* Install button style */
        #installButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        #installButton:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        /* Nowe style dla wielu us≈Çug */
        .selected-services-list {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e9;
            border-radius: 8px;
            border-left: 5px solid #2ecc71;
        }
        
        .selected-service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px;
            margin: 3px 0;
        }
        
        .remove-service-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 2px 6px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        /* Modal do edycji wizyty */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 600px;
        }
        
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close-modal:hover {
            color: black;
        }
        
        /* Style dla telefonu */
        .phone-link {
            color: #3498db;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .phone-link:hover {
            color: #2980b9;
        }
        
        /* Przycisk usuwania z potwierdzeniem */
        .confirm-delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .confirm-delete-btn:hover {
            background: #c0392b;
        }
        
        .confirm-delete-container {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #ffebee;
            border-radius: 8px;
        }
        
        .confirm-delete-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Ekran logowania -->
    <div id="login-view" class="view active-view login-container">
        <div class="logo-header">
            <h1>Harmonogram Salonu</h1>
            <p>Profesjonalne zarzƒÖdzanie wizytami</p>
        </div>
        <input type="password" id="password" placeholder="Wprowad≈∫ has≈Ço">
        <button onclick="login()">Zaloguj</button>
        <p id="login-error"></p>
    </div>

    <!-- Wyb√≥r pracownika -->
    <div id="employee-view" class="view employee-select">
        <div class="logo-header">
            <h1>Wybierz pracownika</h1>
            <p>Kontynuuj do swojego harmonogramu</p>
        </div>
        
        <div class="employee-list" id="employee-list">
            <!-- Lista pracownik√≥w bƒôdzie dodana dynamicznie -->
        </div>
    </div>

    <!-- G≈Ç√≥wny kalendarz -->
    <div id="calendar-view" class="view container">
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showView('calendar-view')">Kalendarz</div>
            <div class="nav-tab" onclick="showView('clients-view')">Baza Klient√≥w</div>
            <div class="nav-tab" onclick="showView('employees-view')">Pracownicy</div>
            <div class="nav-tab" onclick="showView('stats-view')">Statystyki</div>
        </div>
        
        <div class="employee-header">
            <div>
                <h1>Harmonogram Pracy</h1>
                <h2 id="employee-name" style="color: #3498db;"></h2>
            </div>
            <button id="switch-employee-btn" onclick="switchEmployee()">Zmie≈Ñ pracownika</button>
        </div>
        
        <div class="calendar-header">
            <div class="calendar-nav">
                <button id="prev-month">‚Üê Poprz.</button>
                <h2 id="current-month">Lipiec 2024</h2>
                <button id="next-month">Nast. ‚Üí</button>
            </div>
            
            <div>
                <button onclick="showCurrentDate()">Dzisiaj</button>
            </div>
        </div>
        
        <div class="calendar" id="calendar">
            <!-- Nag≈Ç√≥wki dni tygodnia bƒôdƒÖ dodane dynamicznie -->
        </div>
        
        <div class="stats-container">
            <div class="stat-box">
                <h3>Zarobki miesiƒÖca</h3>
                <div class="stat-value"><span id="monthly-earnings">0</span> z≈Ç</div>
                <div class="stat-label">≈ÅƒÖcznie w tym miesiƒÖcu</div>
            </div>
            
            <div class="stat-box">
                <h3>NadchodzƒÖce wizyty</h3>
                <div class="stat-value"><span id="upcoming-appointments">0</span></div>
                <div class="stat-label">W najbli≈ºszych 7 dniach</div>
            </div>
            
            <div class="stat-box">
                <h3>Nowi klienci</h3>
                <div class="stat-value"><span id="new-clients">0</span></div>
                <div class="stat-label">W tym miesiƒÖcu</div>
            </div>
        </div>
        
        <div class="day-details" id="day-details">
            <div class="day-navigation">
                <button onclick="navigateDay(-1)">‚Üê Poprz. dzie≈Ñ</button>
                <h3 id="selected-day">24 Lipca 2024</h3>
                <button onclick="navigateDay(1)">Nast. dzie≈Ñ ‚Üí</button>
            </div>
            
            <button onclick="hideDayDetails()">‚Üê Wr√≥ƒá do kalendarza</button>
            
            <div class="add-appointment">
                <h3>Dodaj wizytƒô</h3>
                
                <div class="autocomplete-container">
                    <input type="text" id="client-name" placeholder="Imiƒô klienta" autocomplete="off">
                    <div id="autocomplete-list" class="autocomplete-items"></div>
                </div>
                
                <input type="text" id="client-phone" placeholder="Numer telefonu">
                
                <h4>Wybierz us≈Çugƒô:</h4>
                <div class="service-container" id="service-options-container">
                    <!-- Us≈Çugi bƒôdƒÖ renderowane dynamicznie -->
                </div>
                
                <div class="selected-services-list" id="selected-services-list" style="display: none;">
                    <h4>Wybrane us≈Çugi:</h4>
                    <div id="selected-services-container"></div>
                </div>
                
                <div class="time-inputs">
                    <select id="start-hour">
                        <option value="">Godzina rozpoczƒôcia</option>
                    </select>
                </div>
                
                <div class="duration-slider-container">
                    <h4>Czas trwania us≈Çugi:</h4>
                    <input type="range" id="duration-slider" min="5" max="300" step="5" value="30" class="duration-slider">
                    <div class="duration-value">
                        <span>5 min</span>
                        <span id="duration-display" class="duration-display">30 min</span>
                        <span>5 godz.</span>
                    </div>
                </div>
                
                <button onclick="addAppointment()">Dodaj wizytƒô</button>
                <p id="time-error" style="color:#e74c3c;"></p>
            </div>
            
            <h3>Harmonogram dnia</h3>
            <div class="timeline-container" id="timeline-container"></div>
            
            <h3>Lista wizyt</h3>
            <div class="table-wrapper">
                <div class="day-schedule" id="day-schedule">
                    <!-- Harmonogram dnia w dw√≥ch kolumnach -->
                </div>
            </div>
            
            <div class="summary">
                <h3>Podsumowanie dnia</h3>
                <p>Liczba wizyt: <span id="day-count">0</span></p>
                <p>Zarobki: <span id="day-earnings">0</span> z≈Ç</p>
            </div>
        </div>
    </div>

    <!-- Baza klient√≥w -->
    <div id="clients-view" class="view container">
        <div class="nav-tabs">
            <div class="nav-tab" onclick="showView('calendar-view')">Kalendarz</div>
            <div class="nav-tab" onclick="showView('clients-view')">Baza Klient√≥w</div>
            <div class="nav-tab" onclick="showView('employees-view')">Pracownicy</div>
            <div class="nav-tab" onclick="showView('stats-view')">Statystyki</div>
        </div>
        
        <h1>Baza Klient√≥w</h1>
        
        <div class="client-form">
            <h3>Dodaj nowego klienta</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Imiƒô i nazwisko</label>
                    <input type="text" id="new-client-name" placeholder="Imiƒô i nazwisko">
                </div>
                <div class="form-group">
                    <label>Numer telefonu</label>
                    <input type="text" id="new-client-phone" placeholder="Numer telefonu">
                </div>
            </div>
            <div class="form-group">
                <label>Notatki</label>
                <textarea id="new-client-notes" placeholder="Notatki o kliencie" rows="3"></textarea>
            </div>
            <button onclick="addClient()">Dodaj klienta</button>
        </div>
        
        <div class="table-wrapper">
            <table class="clients-table">
                <thead>
                    <tr>
                        <th>Imiƒô i nazwisko</th>
                        <th>Numer telefonu</th>
                        <th>Notatki</th>
                        <th>Akcje</th>
                    </tr>
                </thead>
                <tbody id="clients-list">
                    <!-- Klienci bƒôdƒÖ dodawani dynamicznie -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ZarzƒÖdzanie pracownikami -->
    <div id="employees-view" class="view container">
        <div class="nav-tabs">
            <div class="nav-tab" onclick="showView('calendar-view')">Kalendarz</div>
            <div class="nav-tab" onclick="showView('clients-view')">Baza Klient√≥w</div>
            <div class="nav-tab active" onclick="showView('employees-view')">Pracownicy</div>
            <div class="nav-tab" onclick="showView('stats-view')">Statystyki</div>
        </div>
        
        <h1>ZarzƒÖdzanie pracownikami</h1>
        
        <div class="add-appointment">
            <h3>Dodaj nowego pracownika</h3>
            <input type="text" id="new-employee-name" placeholder="Imiƒô i nazwisko pracownika">
            <button onclick="addEmployee()" style="margin-top: 15px;">Dodaj pracownika</button>
        </div>
        
        <div class="table-wrapper">
            <table class="clients-table">
                <thead>
                    <tr>
                        <th>Imiƒô i nazwisko</th>
                        <th>Akcje</th>
                    </tr>
                </thead>
                <tbody id="employees-table">
                    <!-- Lista pracownik√≥w bƒôdzie dodana dynamicznie -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Statystyki -->
    <div id="stats-view" class="view container">
        <div class="nav-tabs">
            <div class="nav-tab" onclick="showView('calendar-view')">Kalendarz</div>
            <div class="nav-tab" onclick="showView('clients-view')">Baza Klient√≥w</div>
            <div class="nav-tab" onclick="showView('employees-view')">Pracownicy</div>
            <div class="nav-tab active" onclick="showView('stats-view')">Statystyki</div>
        </div>
        
        <h1>Statystyki Salonu</h1>
        
        <div class="stats-container" id="salon-stats-container">
            <div class="stat-box">
                <h3>≈ÅƒÖczne zarobki</h3>
                <div class="stat-value"><span id="total-earnings">0</span> z≈Ç</div>
                <div class="stat-label">W tym miesiƒÖcu</div>
            </div>
            
            <div class="stat-box">
                <h3>Wykonane us≈Çugi</h3>
                <div class="stat-value"><span id="total-services">0</span></div>
                <div class="stat-label">W tym miesiƒÖcu</div>
            </div>
            
            <div class="stat-box">
                <h3>Nowi klienci</h3>
                <div class="stat-value"><span id="total-new-clients">0</span></div>
                <div class="stat-label">W tym miesiƒÖcu</div>
            </div>
        </div>
        
        <div class="summary" style="margin-top: 30px;">
            <h3>Statystyki pracownik√≥w</h3>
            <div id="employee-stats-container" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
                <!-- Statystyki pracownik√≥w bƒôdƒÖ dodane dynamicznie -->
            </div>
        </div>
        
        <!-- Podsumowanie roczne -->
        <div class="yearly-summary-section">
            <h3>Podsumowanie roczne</h3>
            <div class="form-group">
                <label for="year-select">Wybierz rok:</label>
                <select id="year-select" onchange="renderYearlyStats(this.value)"></select>
            </div>
            <div id="yearly-stats-container" class="stats-container">
                <!-- Statystyki dla wybranego roku bƒôdƒÖ wy≈õwietlane tutaj -->
            </div>
        </div>
        
        <!-- Podsumowanie lat -->
        <div class="year-summary-section">
            <h3>Podsumowanie lat</h3>
            <div class="table-wrapper">
                <table class="clients-table year-summary-table">
                    <thead>
                        <tr>
                            <th>Rok</th>
                            <th>≈ÅƒÖczne zarobki</th>
                            <th>Liczba us≈Çug</th>
                            <th>Nowi klienci</th>
                        </tr>
                    </thead>
                    <tbody id="year-summary-table">
                        <!-- Tabela z podsumowaniami rocznymi -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Sekcja resetowania statystyk -->
        <div class="reset-section">
            <div class="reset-warning">‚ö†Ô∏è Uwaga: Operacja nieodwracalna!</div>
            <div class="reset-description">
                Klikniƒôcie tego przycisku spowoduje wyzerowanie wszystkich statystyk zarobk√≥w.<br>
                Dane wizyt zostanƒÖ zachowane, ale wszystkie ceny zostanƒÖ ustawione na 0 z≈Ç.
            </div>
            <button class="reset-stats" onclick="resetAllStats()">Wyzeruj wszystkie statystyki</button>
        </div>
    </div>

    <!-- Modal do edycji wizyty -->
    <div id="edit-appointment-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <h3>Edytuj wizytƒô</h3>
            
            <div class="autocomplete-container">
                <input type="text" id="edit-client-name" placeholder="Imiƒô klienta" autocomplete="off">
                <div id="edit-autocomplete-list" class="autocomplete-items"></div>
            </div>
            
            <input type="text" id="edit-client-phone" placeholder="Numer telefonu">
            
            <h4>Wybierz us≈Çugƒô:</h4>
            <div class="service-container" id="edit-service-options-container">
                <!-- Us≈Çugi bƒôdƒÖ renderowane dynamicznie -->
            </div>
            
            <div class="selected-services-list" id="edit-selected-services-list" style="display: none;">
                <h4>Wybrane us≈Çugi:</h4>
                <div id="edit-selected-services-container"></div>
            </div>
            
            <div class="time-inputs">
                <select id="edit-start-hour">
                    <option value="">Godzina rozpoczƒôcia</option>
                </select>
            </div>
            
            <div class="duration-slider-container">
                <h4>Czas trwania us≈Çugi:</h4>
                <input type="range" id="edit-duration-slider" min="5" max="300" step="5" value="30" class="duration-slider">
                <div class="duration-value">
                    <span>5 min</span>
                    <span id="edit-duration-display" class="duration-display">30 min</span>
                    <span>5 godz.</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Cena (z≈Ç):</label>
                <input type="number" id="edit-price" placeholder="Cena">
            </div>
            
            <button onclick="saveEditedAppointment()">Zapisz zmiany</button>
            <p id="edit-time-error" style="color:#e74c3c;"></p>
        </div>
    </div>

    <!-- Przycisk instalacji PWA -->
    <button id="installButton" aria-label="Install app">Zainstaluj aplikacjƒô</button>

    <script>
        // Lista us≈Çug
        const services = [
            {
                category: "üíÖ MANICURE",
                items: [
                    "MANICURE BIOLOGICZNY (opracowanie sk√≥rek i kszta≈Çtu + od≈ºywka)",
                    "MANICURE HYBRYDOWY",
                    "UTWARDZENIE NATURALNEJ P≈ÅYTKI ≈ªELEM / UZUPE≈ÅNIENIE",
                    "MANICURE ≈ªELOWY Z PRZED≈ÅU≈ªENIEM",
                    "REKONSTRUKCJA PAZNOKCI OGRYZIONYCH"
                ]
            },
            {
                category: "‚ú® DODATKOWE US≈ÅUGI",
                items: [
                    "NAPRAWA JEDNEGO PAZNOKCIA PO TERMINIE REKLAMACJI",
                    "ZDOBIENIE",
                    "FRENCH / OMBRE",
                    "OMBRE 3 KOLOROWE",
                    "ZDOBIENIE PRINCESS NAILS",
                    "CYRKONIE",
                    "≈öCIƒÑGNIƒòCIE STYLIZACJI HYBRYDOWEJ + MANICURE BIOLOGICZNY",
                    "≈öCIƒÑGNIƒòCIE STYLIZACJI ≈ªELOWEJ + MANICURE BIOLOGICZNY",
                    "≈öCIƒÑGNIƒòCIE STYLIZACJI HYBRYDOWEJ PO INNEJ STYLISTCE",
                    "≈öCIƒÑGNIƒòCIE STYLIZACJI ≈ªELOWEJ PO INNEJ STYLISTCE"
                ]
            },
            {
                category: "ü¶∂ PEDICURE",
                items: [
                    "PEDICURE BIOLOGICZNY (opracowanie sk√≥rek i kszta≈Çtu + od≈ºywka)",
                    "PEDICURE HYBRYDOWY",
                    "OPRACOWANIE PODESZWY Z MASA≈ªEM + PEDICURE HYBRYDOWY",
                    "OPRACOWANIE PODESZWY Z MASA≈ªEM + PEDICURE BIOLOGICZNY"
                ]
            },
            {
                category: "üëÅÔ∏è STYLIZACJA BRWI I RZƒòS",
                items: [
                    "REGULACJA BRWI",
                    "HENNA KLASYCZNA + REGULACJA BRWI",
                    "HENNA PUDROWA + REGULACJA BRWI",
                    "HENNA RZƒòs"
                ]
            },
            {
                category: "üïäÔ∏è DEPILACJA WOSKIEM",
                items: [
                    "WƒÑSIK",
                    "BRODA",
                    "BRODA + SZYJA",
                    "BACZKI",
                    "CA≈ÅA TWARZ"
                ]
            },
            {
                category: "üíÑ MAKIJA≈ª",
                items: [
                    "MAKIJA≈ª ≈öLUBNY / OKOLICZNO≈öCIOWY",
                    "MAKIJA≈ª ≈öLUBNY / OKOLICZNO≈öCIOWY W NIEDZIELE I ≈öWIƒòTA"
                ]
            },
            {
                category: "üìù INNE US≈ÅUGI",
                items: ["Inna us≈Çuga..."]
            }
        ];

        // Dane
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let selectedDay = null;
        let currentEmployee = null;
        let selectedDuration = 30;
        let selectedServices = [];
        
        // Zmienne do nawigacji dni
        let currentDetailDay = null;
        let currentDetailMonth = null;
        let currentDetailYear = null;
        
        // Zmienne do edycji wizyty
        let currentlyEditingAppointmentIndex = null;
        let currentlyEditingAppointmentDateKey = null;
        
        // Inicjalizacja danych
        let employeesData = [];
        let appointmentsData = {}; // To bƒôdzie synchronizowane z Firebase
        let clientsData = [];

        // Zmienne dla PWA
        let deferredPrompt;
        const installButton = document.getElementById('installButton');

        // Funkcje pomocnicze
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function minutesToTime(minutes) {
            const hours = Math.floor(minutes / 60) % 24;
            const mins = minutes % 60;
            return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
        }

        function formatDuration(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return hours > 0 ? `${hours}h ${mins}min` : `${mins} min`;
        }
        
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active-view');
            });
            document.getElementById(viewId).classList.add('active-view');
            
            if (viewId === 'stats-view') {
                renderEmployeeStats();
                renderYearSelector();
                renderYearSummaryTable();
            }
        }

        // Inicjalizacja
        function initTimeOptions() {
            const startHourSelect = document.getElementById('start-hour');
            startHourSelect.innerHTML = '<option value="">Godzina rozpoczƒôcia</option>';
            
            // Harmonogram zaczyna siƒô od 5:00
            for (let hour = 5; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 5) {
                    const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = time;
                    startHourSelect.appendChild(option);
                }
            }
            
            const slider = document.getElementById('duration-slider');
            const display = document.getElementById('duration-display');
            
            slider.value = selectedDuration;
            display.textContent = formatDuration(selectedDuration);
            
            slider.addEventListener('input', function() {
                selectedDuration = parseInt(this.value);
                display.textContent = formatDuration(selectedDuration);
                updateAvailableTimes();
            });
            
            renderServiceOptions();
            renderClientsList();
            renderEmployeesList();
            renderEmployeesTable();
            
            // Autouzupe≈Çnianie dla klient√≥w
            document.getElementById('client-name').addEventListener('input', function() {
                const input = this.value.toLowerCase();
                const autocompleteList = document.getElementById('autocomplete-list');
                autocompleteList.innerHTML = '';
                
                if (input.length < 2) return;
                
                const matches = clientsData.filter(client => 
                    client.name.toLowerCase().includes(input)
                );
                
                if (matches.length > 0) {
                    matches.forEach(client => {
                        const item = document.createElement('div');
                        item.className = 'autocomplete-item';
                        item.innerHTML = `<strong>${client.name}</strong> - ${client.phone}`;
                        item.addEventListener('click', () => {
                            document.getElementById('client-name').value = client.name;
                            document.getElementById('client-phone').value = client.phone;
                            autocompleteList.innerHTML = '';
                        });
                        autocompleteList.appendChild(item);
                    });
                }
            });
        }
        
        function renderEmployeesList() {
            const listEl = document.getElementById('employee-list');
            listEl.innerHTML = '<h3>Lista pracownik√≥w</h3>';
            
            employeesData.forEach(employee => {
                const employeeEl = document.createElement('div');
                employeeEl.className = 'employee-item';
                employeeEl.innerHTML = `
                    <div>${employee.name}</div>
                    <div>
                        <button onclick="selectEmployee(${employee.id})">Wybierz</button>
                    </div>
                `;
                listEl.appendChild(employeeEl);
            });
        }
        
        function renderEmployeesTable() {
            const tableBody = document.getElementById('employees-table');
            tableBody.innerHTML = '';
            
            employeesData.forEach(employee => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>
                        <button onclick="editEmployee(${employee.id})">Edytuj</button>
                        <button class="delete" onclick="deleteEmployee(${employee.id})">Usu≈Ñ</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function renderServiceOptions(containerId = 'service-options-container') {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            services.forEach(category => {
                const categoryEl = document.createElement('div');
                categoryEl.className = 'service-category';
                categoryEl.innerHTML = `<h4>${category.category}</h4>`;
                
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'service-options';
                
                category.items.forEach(service => {
                    const optionEl = document.createElement('div');
                    optionEl.className = 'service-option';
                    optionEl.textContent = service;
                    optionEl.onclick = () => toggleServiceSelection(service, categoryEl, containerId);
                    optionsContainer.appendChild(optionEl);
                });
                
                categoryEl.appendChild(optionsContainer);
                
                // Dodaj pole dla w≈Çasnej us≈Çugi
                if (category.category === "üìù INNE US≈ÅUGI") {
                    const inputEl = document.createElement('input');
                    inputEl.type = 'text';
                    inputEl.className = 'other-service-input';
                    inputEl.placeholder = "Wpisz nazwƒô us≈Çugi";
                    inputEl.style.display = 'none';
                    inputEl.oninput = function() {
                        if (containerId === 'service-options-container') {
                            updateSelectedServicesList();
                        } else {
                            updateEditSelectedServicesList();
                        }
                    };
                    categoryEl.appendChild(inputEl);
                }
                
                container.appendChild(categoryEl);
            });
        }
        
        function toggleServiceSelection(service, categoryEl, containerId) {
            const isEditMode = containerId === 'edit-service-options-container';
            const servicesList = isEditMode ? selectedServices : selectedServices;
            
            if (service === "Inna us≈Çuga...") {
                // Poka≈º pole do wpisania w≈Çasnej us≈Çugi
                const input = categoryEl.querySelector('.other-service-input');
                input.style.display = 'block';
                input.value = '';
                input.focus();
                
                if (isEditMode) {
                    input.addEventListener('blur', function() {
                        if (this.value.trim() !== '') {
                            if (!selectedServices.includes(this.value)) {
                                selectedServices.push(this.value);
                                updateEditSelectedServicesList();
                            }
                        }
                    });
                }
            } else {
                // Ukryj wszystkie pola w≈Çasnych us≈Çug
                document.querySelectorAll('.other-service-input').forEach(el => {
                    el.style.display = 'none';
                });
                
                // Dodaj lub usu≈Ñ us≈Çugƒô z listy
                const index = servicesList.indexOf(service);
                if (index === -1) {
                    servicesList.push(service);
                } else {
                    servicesList.splice(index, 1);
                }
                
                // Odznacz wszystkie opcje
                document.querySelectorAll(`#${containerId} .service-option`).forEach(el => {
                    el.classList.remove('selected');
                });
                
                // Zaznacz tylko wybrane us≈Çugi
                servicesList.forEach(selectedService => {
                    document.querySelectorAll(`#${containerId} .service-option`).forEach(el => {
                        if (el.textContent === selectedService) {
                            el.classList.add('selected');
                        }
                    });
                });
                
                if (isEditMode) {
                    updateEditSelectedServicesList();
                } else {
                    updateSelectedServicesList();
                }
            }
        }
        
        function updateSelectedServicesList() {
            const container = document.getElementById('selected-services-container');
            container.innerHTML = '';
            
            if (selectedServices.length === 0) {
                document.getElementById('selected-services-list').style.display = 'none';
                return;
            }
            
            document.getElementById('selected-services-list').style.display = 'block';
            
            selectedServices.forEach((service, index) => {
                const item = document.createElement('div');
                item.className = 'selected-service-item';
                item.innerHTML = `
                    <span>${service}</span>
                    <button class="remove-service-btn" onclick="removeService(${index}, false)">√ó</button>
                `;
                container.appendChild(item);
            });
        }
        
        function updateEditSelectedServicesList() {
            const container = document.getElementById('edit-selected-services-container');
            container.innerHTML = '';
            
            if (selectedServices.length === 0) {
                document.getElementById('edit-selected-services-list').style.display = 'none';
                return;
            }
            
            document.getElementById('edit-selected-services-list').style.display = 'block';
            
            selectedServices.forEach((service, index) => {
                const item = document.createElement('div');
                item.className = 'selected-service-item';
                item.innerHTML = `
                    <span>${service}</span>
                    <button class="remove-service-btn" onclick="removeService(${index}, true)">√ó</button>
                `;
                container.appendChild(item);
            });
        }
        
        function removeService(index, isEditMode) {
            selectedServices.splice(index, 1);
            
            if (isEditMode) {
                updateEditSelectedServicesList();
                // Odznacz odpowiedniƒÖ opcjƒô w edycji
                document.querySelectorAll('#edit-service-options-container .service-option').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedServices.forEach(service => {
                    document.querySelectorAll('#edit-service-options-container .service-option').forEach(el => {
                        if (el.textContent === service) {
                            el.classList.add('selected');
                        }
                    });
                });
            } else {
                updateSelectedServicesList();
                // Odznacz odpowiedniƒÖ opcjƒô w dodawaniu
                document.querySelectorAll('#service-options-container .service-option').forEach(el => {
                    el.classList.remove('selected');
                });
                selectedServices.forEach(service => {
                    document.querySelectorAll('#service-options-container .service-option').forEach(el => {
                        if (el.textContent === service) {
                            el.classList.add('selected');
                        }
                    });
                });
            }
        }

        function updateAvailableTimes(selectId = 'start-hour') {
            if (!currentEmployee || !currentDetailDay) return;
            
            const startHourSelect = document.getElementById(selectId);
            const currentValue = startHourSelect.value;
            const availableTimes = getAvailableTimes();
            
            startHourSelect.innerHTML = '<option value="">Godzina rozpoczƒôcia</option>';
            
            availableTimes.forEach(time => {
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                if (time === currentValue) option.selected = true;
                startHourSelect.appendChild(option);
            });
        }

        function getAvailableTimes() {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            const allTimes = [];
            
            // Harmonogram zaczyna siƒô od 5:00
            for (let hour = 5; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 5) {
                    allTimes.push(`${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`);
                }
            }
            
            if (appointments.length === 0) return allTimes;
            
            return allTimes.filter(time => {
                const timeMinutes = timeToMinutes(time);
                
                // Sprawd≈∫ kolizjƒô z w≈Çasnymi wizytami
                for (const appointment of appointments) {
                    // Pomijamy wizytƒô, kt√≥rƒÖ aktualnie edytujemy
                    if (currentlyEditingAppointmentIndex !== null && 
                        appointments.indexOf(appointment) === currentlyEditingAppointmentIndex) {
                        continue;
                    }
                    
                    const appStart = timeToMinutes(appointment.startTime);
                    const appEnd = timeToMinutes(appointment.endTime);
                    
                    if ((timeMinutes >= appStart && timeMinutes < appEnd) ||
                        (timeMinutes + selectedDuration > appStart && timeMinutes + selectedDuration <= appEnd) ||
                        (timeMinutes <= appStart && timeMinutes + selectedDuration >= appEnd)) {
                        return false;
                    }
                }
                
                // Sprawd≈∫ blokady pedicure u innych pracownik√≥w TYLKO je≈õli wybrana us≈Çuga to pedicure
                if (selectedServices.some(service => service.includes("PEDICURE"))) {
                    const otherEmployee = employeesData.find(e => e.id.toString() !== currentEmployee);
                    if (otherEmployee) {
                        const otherEmployeeId = otherEmployee.id.toString();
                        const otherEmployeeData = appointmentsData[otherEmployeeId] || {};
                        const otherAppointments = otherEmployeeData[dateKey] || [];
                        
                        for (const appointment of otherAppointments) {
                            if (appointment.service.includes("PEDICURE")) {
                                const appStart = timeToMinutes(appointment.startTime);
                                const appEnd = timeToMinutes(appointment.endTime);
                                
                                if ((timeMinutes >= appStart && timeMinutes < appEnd) ||
                                    (timeMinutes + selectedDuration > appStart && timeMinutes + selectedDuration <= appEnd) ||
                                    (timeMinutes <= appStart && timeMinutes + selectedDuration >= appEnd)) {
                                    return false;
                                }
                            }
                        }
                    }
                }
                
                return true;
            });
        }

        // Logowanie i wyb√≥r pracownika
        function login() {
            const password = document.getElementById('password').value;
            if (password === "1234") {
                document.getElementById('login-view').classList.remove('active-view');
                document.getElementById('employee-view').classList.add('active-view');
                document.getElementById('login-error').textContent = "";
                
                // Renderuj listƒô pracownik√≥w po zalogowaniu
                renderEmployeesList();
            } else {
                document.getElementById('login-error').textContent = "B≈Çƒôdne has≈Ço!";
            }
        }
        
        // Obs≈Çuga klawisza Enter w polu has≈Ça
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });

        function selectEmployee(employeeId) {
            currentEmployee = employeeId.toString();
            const employee = employeesData.find(e => e.id === employeeId);
            
            if (employee) {
                document.getElementById('employee-view').classList.remove('active-view');
                document.getElementById('calendar-view').classList.add('active-view');
                document.getElementById('employee-name').textContent = employee.name;
                
                // Utw√≥rz pusty kalendarz je≈õli pracownik nie istnieje
                if (!appointmentsData[currentEmployee]) {
                    appointmentsData[currentEmployee] = {};
                    // Nie zapisujemy ju≈º pustego obiektu do localStorage, bo dane bƒôdƒÖ z Firebase
                }
                
                renderCalendar();
                initTimeOptions();
                updateMonthlySummary();
            } else {
                alert("B≈ÇƒÖd: Nie znaleziono pracownika!");
            }
        }

        function switchEmployee() {
            document.getElementById('calendar-view').classList.remove('active-view');
            document.getElementById('employee-view').classList.add('active-view');
        }

        function addEmployee() {
            const name = document.getElementById('new-employee-name').value.trim();
            if (!name) {
                alert('Podaj imiƒô i nazwisko pracownika!');
                return;
            }
            
            // Generuj nowe ID
            const newId = employeesData.length > 0 ? Math.max(...employeesData.map(e => e.id)) + 1 : 1;
            
            employeesData.push({ id: newId, name: name });
            localStorage.setItem('employeesData', JSON.stringify(employeesData));
            
            // Utw√≥rz pusty kalendarz dla nowego pracownika (lokalnie, Firebase to zsynchronizuje)
            appointmentsData[newId] = {};
            // Nie zapisujemy ju≈º pustego obiektu do localStorage, bo dane bƒôdƒÖ z Firebase
            
            document.getElementById('new-employee-name').value = '';
            renderEmployeesList();
            renderEmployeesTable();
        }
        
        function editEmployee(employeeId) {
            const newName = prompt('Podaj nowe imiƒô i nazwisko pracownika:');
            if (newName && newName.trim() !== '') {
                const employee = employeesData.find(e => e.id === employeeId);
                if (employee) {
                    employee.name = newName.trim();
                    localStorage.setItem('employeesData', JSON.stringify(employeesData));
                    // Je≈õli edytujemy aktualnie zalogowanego pracownika, to aktualizujemy nag≈Ç√≥wek
                    if (currentEmployee == employeeId) {
                        document.getElementById('employee-name').textContent = employee.name;
                    }
                    renderEmployeesList();
                    renderEmployeesTable();
                }
            }
        }
        
        function deleteEmployee(employeeId) {
            if (confirm('Czy na pewno chcesz usunƒÖƒá tego pracownika? Wszystkie jego wizyty r√≥wnie≈º zostanƒÖ usuniƒôte.')) {
                // Usu≈Ñ pracownika z listy
                employeesData = employeesData.filter(e => e.id !== employeeId);
                localStorage.setItem('employeesData', JSON.stringify(employeesData));
                
                // Usu≈Ñ kalendarz pracownika (lokalnie)
                delete appointmentsData[employeeId];
                // Nie usuwamy ju≈º z localStorage, bo dane bƒôdƒÖ z Firebase
                
                // Je≈õli usuwamy aktualnie zalogowanego pracownika, to wyloguj
                if (currentEmployee == employeeId) {
                    switchEmployee();
                } else {
                    renderEmployeesList();
                    renderEmployeesTable();
                }
                
                // Upewnij siƒô, ≈ºe nie pr√≥bujemy usunƒÖƒá ostatniego pracownika
                if (employeesData.length === 0) {
                    // Dodaj domy≈õlnego pracownika, aby uniknƒÖƒá b≈Çƒôd√≥w
                    employeesData.push({ id: 1, name: "Nowy Pracownik" });
                    localStorage.setItem('employeesData', JSON.stringify(employeesData));
                    appointmentsData["1"] = {}; // Lokalnie
                }
                // TODO: Usu≈Ñ wizyty tego pracownika z Firebase
            }
        }

        // Kalendarz
        function renderCalendar() {
            const monthNames = [
                "Stycze≈Ñ", "Luty", "Marzec", "Kwiecie≈Ñ", "Maj", "Czerwiec",
                "Lipiec", "Sierpie≈Ñ", "Wrzesie≈Ñ", "Pa≈∫dziernik", "Listopad", "Grudzie≈Ñ"
            ];
            
            document.getElementById('current-month').textContent = 
                `${monthNames[currentMonth]} ${currentYear}`;
            
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';
            
            // Dodaj nag≈Ç√≥wki dni tygodnia
            const daysOfWeek = ['Pon', 'Wto', '≈öro', 'Czw', 'PiƒÖ', 'Sob', 'Nie'];
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                dayHeader.textContent = day;
                calendarEl.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            // Dostosuj dla poniedzia≈Çku jako pierwszego dnia
            const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
            
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Puste miejsca przed pierwszym dniem
            for (let i = 0; i < adjustedFirstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty';
                calendarEl.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';
                
                // Dodaj nag≈Ç√≥wek z nazwƒÖ dnia dla widoku mobilnego
                const dayHeaderMobile = document.createElement('div');
                dayHeaderMobile.className = 'day-header-mobile';
                dayHeaderMobile.textContent = daysOfWeek[(adjustedFirstDay + day - 1) % 7];
                dayEl.appendChild(dayHeaderMobile);
                
                if (day === currentDate.getDate() && 
                    currentMonth === currentDate.getMonth() && 
                    currentYear === currentDate.getFullYear()) {
                    dayEl.classList.add('today');
                }
                
                dayEl.onclick = () => showDayDetails(day, currentMonth, currentYear);
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayEl.appendChild(dayNumber);
                
                const dateKey = `${currentYear}-${currentMonth + 1}-${day}`;
                const employeeData = appointmentsData[currentEmployee] || {};
                const appointments = employeeData[dateKey] || [];
                
                appointments.forEach(appointment => {
                    const appointmentEl = document.createElement('div');
                    appointmentEl.className = 'appointment';
                    appointmentEl.textContent = `${appointment.startTime} ${appointment.clientName.substring(0, 10)}${appointment.clientName.length > 10 ? '...' : ''}`;
                    appointmentEl.title = `${appointment.clientName}\n${appointment.service}\n${appointment.startTime}-${appointment.endTime}`;
                    
                    // Dodaj informacjƒô o innym pracowniku
                    if (appointment.otherEmployee) {
                        const note = document.createElement('div');
                        note.className = 'other-employee-note';
                        note.textContent = `(${appointment.otherEmployee})`;
                        appointmentEl.appendChild(note);
                    }
                    
                    dayEl.appendChild(appointmentEl);
                });
                
                calendarEl.appendChild(dayEl);
            }
            
            updateMonthlySummary();
        }

        function showDayDetails(day, month, year) {
            // Ukryj przycisk zmiany pracownika w widoku dnia
            document.getElementById('switch-employee-btn').style.display = 'none';
            
            currentDetailDay = day;
            currentDetailMonth = month;
            currentDetailYear = year;
            
            const monthNames = [
                "Stycze≈Ñ", "Luty", "Marzec", "Kwiecie≈Ñ", "Maj", "Czerwiec",
                "Lipiec", "Sierpie≈Ñ", "Wrzesie≈Ñ", "Pa≈∫dziernik", "Listopad", "Grudzie≈Ñ"
            ];
            
            document.getElementById('selected-day').textContent = 
                `${day} ${monthNames[month]} ${year}`;
            document.getElementById('calendar').style.display = 'none';
            document.getElementById('day-details').style.display = 'block';
            
            // Resetuj wyb√≥r us≈Çugi
            selectedServices = [];
            document.getElementById('selected-services-list').style.display = 'none';
            document.querySelectorAll('.service-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.other-service-input').forEach(el => {
                el.style.display = 'none';
            });
            
            renderDaySchedule();
            renderTimeline();
            updateAvailableTimes();
        }

        function navigateDay(direction) {
            // direction: -1 dla poprzedniego, 1 dla nastƒôpnego
            const currentDate = new Date(currentDetailYear, currentDetailMonth, currentDetailDay);
            currentDate.setDate(currentDate.getDate() + direction);
            
            showDayDetails(
                currentDate.getDate(),
                currentDate.getMonth(),
                currentDate.getFullYear()
            );
        }

        function hideDayDetails() {
            // Przywr√≥ƒá przycisk zmiany pracownika
            document.getElementById('switch-employee-btn').style.display = 'block';
            
            document.getElementById('calendar').style.display = 'grid';
            document.getElementById('day-details').style.display = 'none';
        }

        // ZarzƒÖdzanie wizytami
        function addAppointment() {
            console.log("addAppointment function called"); // Logowanie na poczƒÖtku funkcji

            const clientName = document.getElementById('client-name').value.trim();
            const clientPhone = document.getElementById('client-phone').value.trim();
            const startTime = document.getElementById('start-hour').value;
            
            if (!clientName || selectedServices.length === 0 || !startTime) {
                document.getElementById('time-error').textContent = 'Wype≈Çnij wszystkie pola!';
                console.log("Validation failed: Missing client name, services, or start time."); // Logowanie b≈Çƒôdu walidacji
                return;
            }
            
            // Zapisz klienta w bazie
            let clientExists = false;
            for (const client of clientsData) {
                if (client.name === clientName && client.phone === clientPhone) {
                    clientExists = true;
                    break;
                }
            }
            
            if (!clientExists) {
                clientsData.push({
                    name: clientName,
                    phone: clientPhone,
                    notes: '',
                    joinDate: new Date().toISOString() // Dodaj datƒô rejestracji
                });
                localStorage.setItem('clientsData', JSON.stringify(clientsData));
                renderClientsList();
                console.log("Client added/updated in localStorage:", { name: clientName, phone: clientPhone }); // Logowanie dodania klienta
            }
            
            const startMinutes = timeToMinutes(startTime);
            const endMinutes = startMinutes + selectedDuration;
            const endTime = minutesToTime(endMinutes);
            
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            
            if (!appointmentsData[currentEmployee]) {
                appointmentsData[currentEmployee] = {};
            }
            
            const employeeData = appointmentsData[currentEmployee];
            
            if (!employeeData[dateKey]) {
                employeeData[dateKey] = [];
            }
            
            const newAppointment = { // Stw√≥rz obiekt nowej wizyty
                clientName: clientName,
                clientPhone: clientPhone,
                service: selectedServices.join(', '),
                startTime: startTime,
                endTime: endTime,
                duration: selectedDuration,
                price: 0,
                otherEmployee: selectedServices.some(s => s.includes("PEDICURE")) ? '' : null,
                employeeId: currentEmployee, // Dodaj ID pracownika
                date: dateKey // Dodaj datƒô wizyty
            };

            const appointments = employeeData[dateKey];
            
            // Sprawd≈∫ kolizjƒô termin√≥w
            for (const appointment of appointments) {
                const appStart = timeToMinutes(appointment.startTime);
                const appEnd = timeToMinutes(appointment.endTime);
                
                if ((startMinutes >= appStart && startMinutes < appEnd) ||
                    (endMinutes > appStart && endMinutes <= appEnd) ||
                    (startMinutes <= appStart && endMinutes >= appEnd)) {
                    document.getElementById('time-error').textContent = 'Termin koliduje z istniejƒÖcƒÖ wizytƒÖ!';
                    console.log("Time conflict detected with existing appointment."); // Logowanie konfliktu czasu
                    return;
                }
            }
            
            document.getElementById('time-error').textContent = '';
            
            // Sprawd≈∫ blokady pedicure u innych pracownik√≥w TYLKO je≈õli wybrana us≈Çuga to pedicure
            if (selectedServices.some(service => service.includes("PEDICURE"))) {
                const otherEmployee = employeesData.find(e => e.id.toString() !== currentEmployee);
                if (otherEmployee) {
                    const otherEmployeeId = otherEmployee.id.toString();
                    const otherEmployeeData = appointmentsData[otherEmployeeId] || {};
                    const otherAppointments = otherEmployeeData[dateKey] || [];
                    
                    for (const appointment of otherAppointments) {
                        if (appointment.service.includes("PEDICURE")) {
                            const appStart = timeToMinutes(appointment.startTime);
                            const appEnd = timeToMinutes(appointment.endTime);
                            
                            if ((startMinutes >= appStart && startMinutes < appEnd) ||
                                (endMinutes > appStart && endMinutes <= appEnd) ||
                                (startMinutes <= appStart && endMinutes >= appEnd)) {
                                
                                document.getElementById('time-error').textContent = 'Termin koliduje z wizytƒÖ pedicure innego pracownika!';
                                console.log("Time conflict detected with other employee's pedicure appointment."); // Logowanie konfliktu pedicure
                                return;
                            }
                        }
                    }
                }
            }
            
            // Wizyta zostanie dodana do lokalnego appointmentsData po synchronizacji z Firebase
            // appointments.push(newAppointment); // Usuniƒôto, bo onSnapshot to zrobi
            
            // appointments.sort((a, b) => timeToMinutes(a.startTime) - timeToMinutes(b.startTime)); // Usuniƒôto, bo onSnapshot to zrobi
            
            // Zapisz dane do localStorage (tylko dla pracownik√≥w i klient√≥w, wizyty z Firebase)
            // localStorage.setItem('appointmentsData', JSON.stringify(appointmentsData)); // Usuniƒôto
            console.log("Appointment data will be synced from Firebase."); // Logowanie zapisu do localStorage
            
            // Zapisz wizytƒô w Firebase Firestore
            console.log("Attempting to save to Firebase:", newAppointment); // Logowanie pr√≥by zapisu do Firebase
            window.zapiszWizyte(newAppointment);

            // renderCalendar(); // Usuniƒôto, bo onSnapshot to zrobi
            
            // Resetuj formularz
            document.getElementById('client-name').value = '';
            document.getElementById('client-phone').value = '';
            selectedServices = [];
            document.getElementById('selected-services-list').style.display = 'none';
            document.querySelectorAll('.service-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('.other-service-input').forEach(el => {
                el.style.display = 'none';
                el.value = '';
            });
            document.getElementById('start-hour').value = '';
            
            // renderDaySchedule(); // Usuniƒôto, bo onSnapshot to zrobi
            // renderTimeline(); // Usuniƒôto, bo onSnapshot to zrobi
            // updateAvailableTimes(); // Usuniƒôto, bo onSnapshot to zrobi
            // updateMonthlySummary(); // Usuniƒôto, bo onSnapshot to zrobi
        }

        function renderDaySchedule() {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const scheduleEl = document.getElementById('day-schedule');
            scheduleEl.innerHTML = '';
            
            // Znajd≈∫ obu pracownik√≥w
            const currentEmployeeObj = employeesData.find(e => e.id.toString() === currentEmployee);
            const otherEmployee = employeesData.find(e => e.id.toString() !== currentEmployee);
            
            // Stw√≥rz kontener
            const scheduleContainer = document.createElement('div');
            scheduleContainer.className = 'day-schedule';
            scheduleEl.appendChild(scheduleContainer);
            
            // Kolumna dla bie≈ºƒÖcego pracownika
            const currentColumn = document.createElement('div');
            currentColumn.className = 'schedule-column';
            currentColumn.innerHTML = `<h3>${currentEmployeeObj.name}</h3>`;
            scheduleContainer.appendChild(currentColumn);
            
            // Pobierz wizyty bie≈ºƒÖcego pracownika
            const currentEmployeeData = appointmentsData[currentEmployee] || {};
            const currentAppointments = currentEmployeeData[dateKey] || [];
            
            // Tabela dla bie≈ºƒÖcego pracownika
            if (currentAppointments.length > 0) {
                const table = document.createElement('table');
                table.className = 'appointments-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Godziny</th>
                            <th>Klient</th>
                            <th>Telefon</th>
                            <th>Us≈Çuga</th>
                            <th>Cena (z≈Ç)</th>
                            <th>Akcje</th>
                        </tr>
                    </thead>
                    <tbody>
                `;
                
                currentAppointments.forEach((appointment, index) => {
                    const row = document.createElement('tr');
                    if (appointment.service.includes("PEDICURE")) {
                        row.classList.add('pedicure-row');
                    }
                    
                    row.innerHTML = `
                        <td>${appointment.startTime}-${appointment.endTime}</td>
                        <td>${appointment.clientName}</td>
                        <td><span class="phone-link" onclick="callClient('${appointment.clientPhone}')">${appointment.clientPhone}</span></td>
                        <td>${appointment.service}</td>
                        <td>
                            <input type="number" class="price-input" value="${appointment.price || ''}" 
                                   onchange="updateAppointmentPrice(${index}, this.value)"
                                   placeholder="Cena">
                        </td>
                        <td>
                            <button onclick="openEditAppointmentModal(${index})">Edytuj</button>
                            <button class="delete" onclick="showDeleteConfirmation(${index})">Usu≈Ñ</button>
                            <div class="confirm-delete-container" id="confirm-delete-${index}">
                                <p>Czy na pewno chcesz usunƒÖƒá tƒô wizytƒô?</p>
                                <div class="confirm-delete-buttons">
                                    <button class="confirm-delete-btn" onclick="deleteAppointment(${index})">Tak</button>
                                    <button onclick="hideDeleteConfirmation(${index})">Nie</button>
                                </div>
                            </div>
                        </td>
                    `;
                    table.querySelector('tbody').appendChild(row);
                });
                
                currentColumn.appendChild(table);
            } else {
                currentColumn.innerHTML += '<div class="empty-schedule">Brak wizyt</div>';
            }
            
            // Kolumna dla drugiego pracownika (tylko pedicure)
            if (otherEmployee) {
                const otherColumn = document.createElement('div');
                otherColumn.className = 'schedule-column';
                otherColumn.innerHTML = `<h3>${otherEmployee.name} (Pedicure)</h3>`;
                scheduleContainer.appendChild(otherColumn);
                
                // Pobierz wizyty drugiego pracownika
                const otherEmployeeData = appointmentsData[otherEmployee.id] || {};
                const otherAppointments = otherEmployeeData[dateKey] || [];
                const pedicureAppointments = otherAppointments.filter(app => app.service.includes("PEDICURE"));
                
                if (pedicureAppointments.length > 0) {
                    const table = document.createElement('table');
                    table.className = 'appointments-table';
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th>Godziny</th>
                                <th>Klient</th>
                                <th>Telefon</th>
                                <th>Us≈Çuga</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;
                    
                    pedicureAppointments.forEach(appointment => {
                        const row = document.createElement('tr');
                        row.classList.add('pedicure-row');
                        
                        row.innerHTML = `
                            <td>${appointment.startTime}-${appointment.endTime}</td>
                            <td>${appointment.clientName}</td>
                            <td><span class="phone-link" onclick="callClient('${appointment.clientPhone}')">${appointment.clientPhone}</span></td>
                            <td>${appointment.service}</td>
                        `;
                        table.querySelector('tbody').appendChild(row);
                    });
                    
                    otherColumn.appendChild(table);
                } else {
                    otherColumn.innerHTML += '<div class="empty-schedule">Brak wizyt pedicure</div>';
                }
            }
            
            updateDaySummary();
        }
        
        function callClient(phoneNumber) {
            if (confirm(`Czy chcesz zadzwoniƒá do klienta pod numer ${phoneNumber}?`)) {
                window.location.href = `tel:${phoneNumber}`;
            }
        }
        
        function showDeleteConfirmation(index) {
            // Ukryj wszystkie inne potwierdzenia
            document.querySelectorAll('.confirm-delete-container').forEach(el => {
                el.style.display = 'none';
            });
            
            // Poka≈º potwierdzenie dla tego indeksu
            document.getElementById(`confirm-delete-${index}`).style.display = 'block';
        }
        
        function hideDeleteConfirmation(index) {
            document.getElementById(`confirm-delete-${index}`).style.display = 'none';
        }
        
        function openEditAppointmentModal(index) {
            currentlyEditingAppointmentIndex = index;
            currentlyEditingAppointmentDateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[currentlyEditingAppointmentDateKey] || [];
            const appointment = appointments[index];
            
            if (!appointment) return;
            
            // Wype≈Çnij formularz edycji
            document.getElementById('edit-client-name').value = appointment.clientName;
            document.getElementById('edit-client-phone').value = appointment.clientPhone;
            document.getElementById('edit-price').value = appointment.price || '';
            
            // Ustaw wybrane us≈Çugi
            selectedServices = appointment.service.split(', ').map(s => s.trim());
            updateEditSelectedServicesList();
            
            // Renderuj opcje us≈Çug z zaznaczeniem
            renderServiceOptions('edit-service-options-container');
            selectedServices.forEach(service => {
                document.querySelectorAll('#edit-service-options-container .service-option').forEach(el => {
                    if (el.textContent === service) {
                        el.classList.add('selected');
                    }
                });
            });
            
            // Ustaw czas trwania
            selectedDuration = appointment.duration || 30;
            document.getElementById('edit-duration-slider').value = selectedDuration;
            document.getElementById('edit-duration-display').textContent = formatDuration(selectedDuration);
            
            // Ustaw godzinƒô rozpoczƒôcia
            const startHourSelect = document.getElementById('edit-start-hour');
            startHourSelect.innerHTML = '<option value="">Godzina rozpoczƒôcia</option>';
            
            for (let hour = 5; hour < 24; hour++) {
                for (let minute = 0; minute < 60; minute += 5) {
                    const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const option = document.createElement('option');
                    option.value = time;
                    option.textContent = time;
                    if (time === appointment.startTime) option.selected = true;
                    startHourSelect.appendChild(option);
                }
            }
            
            // Poka≈º modal
            document.getElementById('edit-appointment-modal').style.display = 'block';
        }
        
        function closeEditModal() {
            document.getElementById('edit-appointment-modal').style.display = 'none';
            currentlyEditingAppointmentIndex = null;
            currentlyEditingAppointmentDateKey = null;
        }
        
        function saveEditedAppointment() {
            const clientName = document.getElementById('edit-client-name').value.trim();
            const clientPhone = document.getElementById('edit-client-phone').value.trim();
            const startTime = document.getElementById('edit-start-hour').value;
            const price = parseInt(document.getElementById('edit-price').value) || 0;
            
            if (!clientName || selectedServices.length === 0 || !startTime) {
                document.getElementById('edit-time-error').textContent = 'Wype≈Çnij wszystkie pola!';
                return;
            }
            
            const startMinutes = timeToMinutes(startTime);
            const endMinutes = startMinutes + selectedDuration;
            const endTime = minutesToTime(endMinutes);
            
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[currentlyEditingAppointmentDateKey] || [];
            const appointment = appointments[currentlyEditingAppointmentIndex];
            
            if (!appointment) return;
            
            // Sprawd≈∫ kolizjƒô termin√≥w (pomijajƒÖc aktualnie edytowanƒÖ wizytƒô)
            for (let i = 0; i < appointments.length; i++) {
                if (i === currentlyEditingAppointmentIndex) continue;
                
                const app = appointments[i];
                const appStart = timeToMinutes(app.startTime);
                const appEnd = timeToMinutes(app.endTime);
                
                if ((startMinutes >= appStart && startMinutes < appEnd) ||
                    (endMinutes > appStart && endMinutes <= appEnd) ||
                    (startMinutes <= appStart && endMinutes >= appEnd)) {
                    document.getElementById('edit-time-error').textContent = 'Termin koliduje z istniejƒÖcƒÖ wizytƒÖ!';
                    return;
                }
            }
            
            document.getElementById('edit-time-error').textContent = '';
            
            // Sprawd≈∫ blokady pedicure u innych pracownik√≥w TYLKO je≈õli wybrana us≈Çuga to pedicure
            if (selectedServices.some(service => service.includes("PEDICURE"))) {
                const otherEmployee = employeesData.find(e => e.id.toString() !== currentEmployee);
                if (otherEmployee) {
                    const otherEmployeeId = otherEmployee.id.toString();
                    const otherEmployeeData = appointmentsData[otherEmployeeId] || {};
                    const otherAppointments = otherEmployeeData[currentlyEditingAppointmentDateKey] || [];
                    
                    for (const otherApp of otherAppointments) {
                        if (otherApp.service.includes("PEDICURE")) {
                            const appStart = timeToMinutes(otherApp.startTime);
                            const appEnd = timeToMinutes(otherApp.endTime);
                            
                            if ((startMinutes >= appStart && startMinutes < appEnd) ||
                                (endMinutes > appStart && endMinutes <= appEnd) ||
                                (startMinutes <= appStart && endMinutes >= appEnd)) {
                                
                                document.getElementById('edit-time-error').textContent = 'Termin koliduje z wizytƒÖ pedicure innego pracownika!';
                                return;
                            }
                        }
                    }
                }
            }
            
            // Aktualizuj wizytƒô
            appointment.clientName = clientName;
            appointment.clientPhone = clientPhone;
            appointment.service = selectedServices.join(', ');
            appointment.startTime = startTime;
            appointment.endTime = endTime;
            appointment.duration = selectedDuration;
            appointment.price = price;
            appointment.otherEmployee = selectedServices.some(s => s.includes("PEDICURE")) ? '' : null; // Poprawka tutaj te≈º
            
            // Posortuj wizyty
            // appointments.sort((a, b) => timeToMinutes(a.startTime) - timeToMinutes(b.startTime)); // Usuniƒôto, bo onSnapshot to zrobi
            
            // Zapisz dane do Firebase (zamiast localStorage)
            window.aktualizujWizyte(appointment.id, appointment); // U≈ºywamy ID dokumentu Firebase
            
            // Zamknij modal i od≈õwie≈º widoki (od≈õwie≈ºy siƒô po onSnapshot)
            closeEditModal();
            // renderCalendar(); // Usuniƒôto
            // renderDaySchedule(); // Usuniƒôto
            // renderTimeline(); // Usuniƒôto
            // updateMonthlySummary(); // Usuniƒôto
        }

        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';
            
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            
            // Grupuj wizyty wed≈Çug godzin
            const hoursMap = {};
            for (let hour = 5; hour < 24; hour++) {
                hoursMap[hour] = [];
            }
            
            appointments.forEach(appointment => {
                const startHour = parseInt(appointment.startTime.split(':')[0]);
                hoursMap[startHour].push(appointment);
            });
            
            // Renderuj timeline
            for (let hour = 5; hour < 24; hour++) {
                const hourEl = document.createElement('div');
                hourEl.className = 'timeline-hour';
                
                const hourLabel = document.createElement('div');
                hourLabel.className = 'hour-label';
                hourLabel.textContent = `${hour}:00`;
                hourEl.appendChild(hourLabel);
                
                const slotsContainer = document.createElement('div');
                slotsContainer.className = 'hour-slots';
                
                // Dodaj wizyty dla tej godziny
                hoursMap[hour].forEach(appointment => {
                    const slot = document.createElement('div');
                    slot.className = 'booked-slot';
                    if (appointment.service.includes("PEDICURE")) {
                        slot.classList.add('pedicure-block');
                    }
                    if (appointment.otherEmployee) {
                        slot.classList.add('other-employee');
                    }
                    
                    const startTime = appointment.startTime;
                    const endTime = appointment.endTime;
                    
                    slot.innerHTML = `
                        <div class="slot-header">
                            <div class="slot-time">${startTime} - ${endTime}</div>
                            <div class="slot-client">${appointment.clientName}</div>
                        </div>
                        <div class="slot-service">${appointment.service}</div>
                        <div class="slot-service"><span class="phone-link" onclick="callClient('${appointment.clientPhone}')">${appointment.clientPhone}</span></div>
                        <div class="slot-actions">
                            <button onclick="openEditAppointmentByFirebaseId('${appointment.id}')">Edytuj</button>
                            <button class="delete" onclick="showDeleteConfirmationByFirebaseId('${appointment.id}')">Usu≈Ñ</button>
                        </div>
                    `;
                    
                    slotsContainer.appendChild(slot);
                });
                
                hourEl.appendChild(slotsContainer);
                container.appendChild(hourEl);
            }
            
            // Dodaj blokady pedicure z innych pracownik√≥w
            const otherEmployee = employeesData.find(e => e.id.toString() !== currentEmployee);
            if (otherEmployee) {
                const otherEmployeeId = otherEmployee.id.toString();
                const otherEmployeeData = appointmentsData[otherEmployeeId] || {};
                const otherAppointments = otherEmployeeData[dateKey] || [];
                
                otherAppointments.forEach(appointment => {
                    if (appointment.service.includes("PEDICURE")) {
                        const startHour = parseInt(appointment.startTime.split(':')[0]);
                        const hourEl = container.querySelectorAll('.timeline-hour')[startHour - 5];
                        if (hourEl) {
                            const slotsContainer = hourEl.querySelector('.hour-slots');
                            
                            const slot = document.createElement('div');
                            slot.className = 'booked-slot other-employee';
                            
                            const startTime = appointment.startTime;
                            const endTime = appointment.endTime;
                            
                            slot.innerHTML = `
                                <div class="slot-header">
                                    <div class="slot-time">${startTime} - ${endTime}</div>
                                    <div class="slot-client">${otherEmployee.name} (Pedicure)</div>
                                </div>
                                <div class="slot-service">${appointment.service}</div>
                                <div class="slot-service" style="color: #e74c3c; font-weight: bold;">
                                    STANOWISKO ZAJƒòTE
                                </div>
                            `;
                            
                            slotsContainer.appendChild(slot);
                        }
                    }
                });
            }
        }
        
        function openEditAppointmentByFirebaseId(firebaseId) {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            
            const index = appointments.findIndex(app => app.id === firebaseId); // Szukamy po ID z Firebase
            if (index !== -1) {
                openEditAppointmentModal(index);
            }
        }
        
        function showDeleteConfirmationByFirebaseId(firebaseId) {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            
            const index = appointments.findIndex(app => app.id === firebaseId); // Szukamy po ID z Firebase
            if (index !== -1) {
                if (confirm('Czy na pewno chcesz usunƒÖƒá tƒô wizytƒô?')) {
                    window.usunWizyte(firebaseId); // Wywo≈Çujemy funkcjƒô usuwania Firebase
                }
            }
        }

        function updateAppointmentPrice(index, price) {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            
            if (appointments[index]) {
                appointments[index].price = parseInt(price) || 0;
                // Zapisz zmiany w Firebase
                window.aktualizujWizyte(appointments[index].id, appointments[index]);
                // updateDaySummary(); // Od≈õwie≈ºy siƒô po onSnapshot
                // updateMonthlySummary(); // Od≈õwie≈ºy siƒô po onSnapshot
            }
        }

        function deleteAppointment(index) {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            
            if (appointments[index]) {
                window.usunWizyte(appointments[index].id); // Usu≈Ñ z Firebase
                // Pozosta≈Çe od≈õwie≈ºenia zostanƒÖ wykonane przez onSnapshot
            }
        }

        // Baza klient√≥w
        function renderClientsList() {
            const clientsList = document.getElementById('clients-list');
            clientsList.innerHTML = '';
            
            clientsData.forEach((client, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${client.name}</td>
                    <td><span class="phone-link" onclick="callClient('${client.phone}')">${client.phone}</span></td>
                    <td>${client.notes}</td>
                    <td>
                        <button onclick="editClient(${index})">Edytuj</button>
                        <button class="delete" onclick="deleteClient(${index})">Usu≈Ñ</button>
                    </td>
                `;
                clientsList.appendChild(row);
            });
        }
        
        function addClient() {
            const name = document.getElementById('new-client-name').value.trim();
            const phone = document.getElementById('new-client-phone').value.trim();
            const notes = document.getElementById('new-client-notes').value.trim();
            
            if (!name) {
                alert('Podaj imiƒô i nazwisko klienta!');
                return;
            }
            
            clientsData.push({ 
                name, 
                phone, 
                notes,
                joinDate: new Date().toISOString() // Dodaj datƒô rejestracji
            });
            localStorage.setItem('clientsData', JSON.stringify(clientsData));
            
            document.getElementById('new-client-name').value = '';
            document.getElementById('new-client-phone').value = '';
            document.getElementById('new-client-notes').value = '';
            
            renderClientsList();
        }
        
        function editClient(index) {
            const client = clientsData[index];
            const newNotes = prompt('Edytuj notatki o kliencie:', client.notes);
            
            if (newNotes !== null) {
                client.notes = newNotes;
                localStorage.setItem('clientsData', JSON.stringify(clientsData));
                renderClientsList();
            }
        }
        
        function deleteClient(index) {
            if (confirm('Czy na pewno chcesz usunƒÖƒá tego klienta?')) {
                clientsData.splice(index, 1);
                localStorage.setItem('clientsData', JSON.stringify(clientsData));
                renderClientsList();
            }
        }

        // Podsumowania
        function updateDaySummary() {
            const dateKey = `${currentDetailYear}-${currentDetailMonth + 1}-${currentDetailDay}`;
            const employeeData = appointmentsData[currentEmployee] || {};
            const appointments = employeeData[dateKey] || [];
            
            document.getElementById('day-count').textContent = appointments.length;
            
            const total = appointments.reduce((sum, app) => sum + (app.price || 0), 0);
            document.getElementById('day-earnings').textContent = total;
        }
        
        function updateMonthlySummary() {
            if (!currentEmployee) return;
            
            let total = 0;
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const employeeData = appointmentsData[currentEmployee] || {};
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateKey = `${currentYear}-${currentMonth + 1}-${day}`;
                const appointments = employeeData[dateKey] || [];
                
                total += appointments.reduce((sum, app) => sum + (app.price || 0), 0);
            }
            
            document.getElementById('monthly-earnings').textContent = total;
        }
        
        // Nowe funkcje dla statystyk salonu
        function calculateSalonStats() {
            let totalEarnings = 0;
            let totalServices = 0;
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            
            // Przejd≈∫ przez wszystkie wizyty wszystkich pracownik√≥w
            for (const employeeId in appointmentsData) {
                const employeeAppointments = appointmentsData[employeeId];
                for (const dateKey in employeeAppointments) {
                    // Sprawd≈∫, czy data jest w bie≈ºƒÖcym miesiƒÖcu i roku
                    const [year, month] = dateKey.split('-').map(Number);
                    if (year === currentYear && month === currentMonth) {
                        const appointments = employeeAppointments[dateKey];
                        totalServices += appointments.length;
                        appointments.forEach(app => {
                            totalEarnings += app.price || 0;
                        });
                    }
                }
            }
            
            // Oblicz nowych klient√≥w w bie≈ºƒÖcym miesiƒÖcu
            const newClients = clientsData.filter(client => {
                if (!client.joinDate) return false;
                const joinDate = new Date(client.joinDate);
                return joinDate.getMonth() + 1 === currentMonth && joinDate.getFullYear() === currentYear;
            }).length;
            
            return { totalEarnings, totalServices, newClients };
        }

        function renderEmployeeStats() {
            const container = document.getElementById('employee-stats-container');
            container.innerHTML = '';
            
            // Oblicz statystyki salonu
            const salonStats = calculateSalonStats();
            document.getElementById('total-earnings').textContent = salonStats.totalEarnings;
            document.getElementById('total-services').textContent = salonStats.totalServices;
            document.getElementById('total-new-clients').textContent = salonStats.newClients;
            
            // Dla ka≈ºdego pracownika oblicz statystyki
            employeesData.forEach(employee => {
                const employeeId = employee.id.toString();
                const employeeData = appointmentsData[employeeId] || {};
                
                let employeeEarnings = 0;
                let employeeServices = 0;
                const currentMonth = new Date().getMonth() + 1;
                const currentYear = new Date().getFullYear();
                
                for (const dateKey in employeeData) {
                    const [year, month] = dateKey.split('-').map(Number);
                    if (year === currentYear && month === currentMonth) {
                        const appointments = employeeData[dateKey];
                        employeeServices += appointments.length;
                        appointments.forEach(app => {
                            employeeEarnings += app.price || 0;
                        });
                    }
                }
                
                // Statystyki dla tego pracownika
                const statBox = document.createElement('div');
                statBox.className = 'stat-box';
                statBox.innerHTML = `
                    <h3>${employee.name}</h3>
                    <div class="stat-value">${employeeEarnings} z≈Ç</div>
                    <div class="stat-label">≈ÅƒÖczne zarobki</div>
                    <div class="stat-value">${employeeServices}</div>
                    <div class="stat-label">Wykonane us≈Çugi</div>
                `;
                
                container.appendChild(statBox);
            });
        }
        
        function resetAllStats() {
            if (confirm('UWAGA: Czy na pewno chcesz wyzerowaƒá WSZYSTKIE statystyki? Ta operacja spowoduje wyzerowanie wszystkich cen wizyt i nie bƒôdzie mo≈ºna jej cofnƒÖƒá.')) {
                // Przejd≈∫ przez wszystkie wizyty wszystkich pracownik√≥w
                for (const employeeId in appointmentsData) {
                    const employeeAppointments = appointmentsData[employeeId];
                    for (const dateKey in employeeAppointments) {
                        const appointments = employeeAppointments[dateKey];
                        appointments.forEach(appointment => {
                            // Aktualizuj cenƒô w Firebase
                            window.aktualizujWizyte(appointment.id, { ...appointment, price: 0 });
                        });
                    }
                }
                // Reszta od≈õwie≈ºe≈Ñ zostanie wykonana przez onSnapshot
            }
        }
        
        function showCurrentDate() {
            currentDate = new Date();
            currentMonth = currentDate.getMonth();
            currentYear = currentDate.getFullYear();
            renderCalendar();
        }
        
        // Funkcje dla podsumowa≈Ñ rocznych i wieloletnich
        function getAvailableYears() {
            const years = new Set();
            
            // Zbierz lata z wizyt
            for (const employeeId in appointmentsData) {
                const employeeAppointments = appointmentsData[employeeId];
                for (const dateKey in employeeAppointments) {
                    const year = parseInt(dateKey.split('-')[0]);
                    if (!isNaN(year)) {
                        years.add(year);
                    }
                }
            }
            
            // Zbierz lata z klient√≥w
            clientsData.forEach(client => {
                if (client.joinDate) {
                    const year = new Date(client.joinDate).getFullYear();
                    years.add(year);
                }
            });
            
            return Array.from(years).sort((a, b) => b - a); // Sortuj od najnowszego
        }
        
        function renderYearSelector() {
            const yearSelect = document.getElementById('year-select');
            yearSelect.innerHTML = '';
            
            const years = getAvailableYears();
            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                if (year === new Date().getFullYear()) {
                    option.selected = true;
                }
                yearSelect.appendChild(option);
            });
            
            if (years.length > 0) {
                renderYearlyStats(years[0]); // Wy≈õwietl statystyki dla najnowszego roku
            }
        }
        
        function calculateYearlyStats(year) {
            let yearlyEarnings = 0;
            let yearlyServices = 0;
            let yearlyNewClients = 0;
            
            // Oblicz zarobki i us≈Çugi dla danego roku
            for (const employeeId in appointmentsData) {
                const employeeAppointments = appointmentsData[employeeId];
                for (const dateKey in employeeAppointments) {
                    const [dateYear] = dateKey.split('-').map(Number);
                    if (dateYear === year) {
                        const appointments = employeeAppointments[dateKey];
                        yearlyServices += appointments.length;
                        appointments.forEach(app => {
                            yearlyEarnings += app.price || 0;
                        });
                    }
                }
            }
            
            // Oblicz nowych klient√≥w w danym roku
            yearlyNewClients = clientsData.filter(client => {
                if (!client.joinDate) return false;
                const joinYear = new Date(client.joinDate).getFullYear();
                return joinYear === year;
            }).length;
            
            return {
                earnings: yearlyEarnings,
                services: yearlyServices,
                newClients: yearlyNewClients
            };
        }
        
        function renderYearlyStats(year) {
            const stats = calculateYearlyStats(parseInt(year));
            const container = document.getElementById('yearly-stats-container');
            container.innerHTML = '';
            
            // Dodaj statystyki w formie box√≥w
            const statBox1 = document.createElement('div');
            statBox1.className = 'stat-box';
            statBox1.innerHTML = `
                <h3>Zarobki</h3>
                <div class="stat-value">${stats.earnings} z≈Ç</div>
                <div class="stat-label">W roku ${year}</div>
            `;
            container.appendChild(statBox1);
            
            const statBox2 = document.createElement('div');
            statBox2.className = 'stat-box';
            statBox2.innerHTML = `
                <h3>Us≈Çugi</h3>
                <div class="stat-value">${stats.services}</div>
                <div class="stat-label">W roku ${year}</div>
            `;
            container.appendChild(statBox2);
            
            const statBox3 = document.createElement('div');
            statBox3.className = 'stat-box';
            statBox3.innerHTML = `
                <h3>Nowi klienci</h3>
                <div class="stat-value">${stats.newClients}</div>
                <div class="stat-label">W roku ${year}</div>
            `;
            container.appendChild(statBox3);
        }
        
        function renderYearSummaryTable() {
            const tableBody = document.getElementById('year-summary-table');
            tableBody.innerHTML = '';
            
            const years = getAvailableYears();
            let totalEarnings = 0;
            let totalServices = 0;
            let totalNewClients = 0;
            
            years.forEach(year => {
                const stats = calculateYearlyStats(year);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${year}</td>
                    <td>${stats.earnings} z≈Ç</td>
                    <td>${stats.services}</td>
                    <td>${stats.newClients}</td>
                `;
                
                tableBody.appendChild(row);
                
                // Suma ca≈Çkowita
                totalEarnings += stats.earnings;
                totalServices += stats.services;
                totalNewClients += stats.newClients;
            });
            
            // Dodaj wiersz podsumowujƒÖcy
            if (years.length > 0) {
                const totalRow = document.createElement('tr');
                totalRow.className = 'year-total';
                totalRow.innerHTML = `
                    <td><strong>≈ÅƒÖcznie</strong></td>
                    <td><strong>${totalEarnings} z≈Ç</strong></td>
                    <td><strong>${totalServices}</strong></td>
                    <td><strong>${totalNewClients}</strong></td>
                `;
                tableBody.appendChild(totalRow);
            }
        }

        // Start aplikacji
        window.onload = function() {
            // Inicjalizuj dane je≈õli nie istniejƒÖ (tylko dla pracownik√≥w i klient√≥w)
            if (localStorage.getItem('employeesData') === null) {
                localStorage.setItem('employeesData', JSON.stringify([
                    { id: 1, name: "Wiktoria Wozowicz-≈öwiniuch" },
                    { id: 2, name: "Weronika Dy≈Ço" }
                ]));
            }
            
            if (localStorage.getItem('clientsData') === null) {
                localStorage.setItem('clientsData', JSON.stringify([]));
            }
            
            // Wczytaj dane z localStorage
            employeesData = JSON.parse(localStorage.getItem('employeesData')) || [];
            clientsData = JSON.parse(localStorage.getItem('clientsData')) || [];
            
            // Wy≈õwietl ekran logowania
            document.getElementById('login-view').classList.add('active-view');
            
            // Inicjalizuj opcje czasu
            initTimeOptions();
            
            // Firebase data will be loaded via onSnapshot listener
        };

        // Obs≈Çuga nawigacji kalendarza
        document.getElementById('prev-month').addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        });

        // PWA - Instalacja aplikacji
        window.addEventListener('beforeinstallprompt', (e) => {
            // Zapobiegaj domy≈õlnemu zachowaniu
            e.preventDefault();
            // Zapisz zdarzenie, aby mo≈ºna by≈Ço je wywo≈Çaƒá p√≥≈∫niej
            deferredPrompt = e;
            // Poka≈º przycisk instalacji
            installButton.style.display = 'block';
        });

        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Poka≈º monit instalacyjny
                deferredPrompt.prompt();
                // Poczekaj na wyb√≥r u≈ºytkownika
                const { outcome } = await deferredPrompt.userChoice;
                // Usu≈Ñ przycisk niezale≈ºnie od wyniku
                installButton.style.display = 'none';
                // Wyczy≈õƒá zapisane zdarzenie
                deferredPrompt = null;
            }
        });

        // Rejestracja Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

    <!-- Firebase SDK (now w wersji 12.0.0 i modularnej) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";

        // Twoja konfiguracja Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDUEmJyLfKGsiES5DmfwPmqr-9hw5cgQIk",
            authDomain: "salo-a6373.firebaseapp.com",
            projectId: "salo-a6373",
            storageBucket: "salo-a6373.firebasestorage.app",
            messagingSenderId: "736895527970",
            appId: "1:736895527970:web:d56af8aca98c561617ee7b",
            measurementId: "G-56WR27VV65"
        };

        // Inicjalizacja Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); // Inicjalizacja Firestore
        const analytics = getAnalytics(app); // Inicjalizacja Analytics

        // Funkcja do zapisu wizyty w Firestore
        window.zapiszWizyte = async function(dane) {
            console.log("zapiszWizyte function called with data:", dane);
            try {
                // Dodajemy id pracownika i datƒô do dokumentu Firebase
                const docRef = await addDoc(collection(db, "wizyty"), dane);
                console.log("Successfully saved to Firebase with ID:", docRef.id);
                alert("Zapisano wizytƒô w Firebase z ID: " + docRef.id);
            } catch (error) {
                console.error("Firebase save error:", error);
                alert("B≈ÇƒÖd zapisu: " + error.message);
            }
        };

        // Funkcja do aktualizacji wizyty w Firestore
        window.aktualizujWizyte = async function(firebaseId, dane) {
            console.log("aktualizujWizyte function called for ID:", firebaseId, "with data:", dane);
            try {
                const docRef = doc(db, "wizyty", firebaseId);
                await updateDoc(docRef, dane);
                console.log("Successfully updated Firebase document with ID:", firebaseId);
                // alert("Wizyta zaktualizowana w Firebase!"); // Mo≈ºesz usunƒÖƒá ten alert po testach
            } catch (error) {
                console.error("Firebase update error for ID:", firebaseId, error);
                alert("B≈ÇƒÖd aktualizacji wizyty: " + error.message);
            }
        };

        // Funkcja do usuwania wizyty z Firestore
        window.usunWizyte = async function(firebaseId) {
            console.log("usunWizyte function called for ID:", firebaseId);
            try {
                await deleteDoc(doc(db, "wizyty", firebaseId));
                console.log("Successfully deleted Firebase document with ID:", firebaseId);
                // alert("Wizyta usuniƒôta z Firebase!"); // Mo≈ºesz usunƒÖƒá ten alert po testach
            } catch (error) {
                console.error("Firebase delete error for ID:", firebaseId, error);
                alert("B≈ÇƒÖd usuwania wizyty: " + error.message);
            }
        };

        // Nas≈Çuchiwanie na zmiany w kolekcji 'wizyty' w czasie rzeczywistym
        onSnapshot(collection(db, "wizyty"), (snapshot) => {
            console.log("Firebase onSnapshot triggered. Changes detected.");
            const newAppointmentsData = {};

            snapshot.docs.forEach(doc => {
                const data = doc.data();
                // Sprawd≈∫, czy dokument ma wymagane pola
                if (data.employeeId && data.date) {
                    const employeeId = data.employeeId.toString();
                    const dateKey = data.date;

                    if (!newAppointmentsData[employeeId]) {
                        newAppointmentsData[employeeId] = {};
                    }
                    if (!newAppointmentsData[employeeId][dateKey]) {
                        newAppointmentsData[employeeId][dateKey] = [];
                    }
                    // Dodaj ID dokumentu z Firebase do obiektu wizyty
                    newAppointmentsData[employeeId][dateKey].push({ ...data, id: doc.id });
                } else {
                    console.warn("Skipping Firestore document due to missing employeeId or date:", doc.id, data);
                }
            });

            // Posortuj wizyty po czasie rozpoczƒôcia
            for (const empId in newAppointmentsData) {
                for (const dateK in newAppointmentsData[empId]) {
                    newAppointmentsData[empId][dateK].sort((a, b) => timeToMinutes(a.startTime) - timeToMinutes(b.startTime));
                }
            }

            // Zaktualizuj globalny obiekt appointmentsData
            appointmentsData = newAppointmentsData;
            console.log("appointmentsData updated from Firebase:", appointmentsData);

            // Prze≈Çadowanie widok√≥w po aktualizacji danych
            if (document.getElementById('calendar-view').classList.contains('active-view')) {
                renderCalendar();
                updateMonthlySummary();
            }
            if (document.getElementById('day-details').style.display === 'block') {
                renderDaySchedule();
                renderTimeline();
                updateDaySummary();
                updateAvailableTimes();
            }
            if (document.getElementById('stats-view').classList.contains('active-view')) {
                renderEmployeeStats();
                renderYearSelector();
                renderYearSummaryTable();
            }
        }, (error) => {
            console.error("Firebase onSnapshot error:", error);
            alert("B≈ÇƒÖd synchronizacji danych z Firebase: " + error.message);
        });
    </script>

</body>
</html>
